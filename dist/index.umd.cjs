(function(J){typeof define=="function"&&define.amd?define(J):J()})(function(){"use strict";const J=new Map;function X(e){let t=J.get(e);return t===void 0&&(t=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),J.set(e,t)),t}function ae(e){return`<${String(e.tagName).toLowerCase()}>`}function fe(e,t){e.nodeType===globalThis.Node.ELEMENT_NODE&&(t(e),e.shadowRoot&&fe(e.shadowRoot,t));const n=globalThis.document.createTreeWalker(e,globalThis.NodeFilter.SHOW_ELEMENT,null,!1);for(;n.nextNode();){const o=n.currentNode;t(o),o.shadowRoot&&fe(o.shadowRoot,t)}}const ue=Promise.resolve(),xe=new WeakMap,Oe=fe.name==="walkInShadow",q=new Set;function Ge(e){q.size||ue.then(Vt),q.add(e)}function Ft(e){q.delete(e)}function Vt(){for(const e of q)try{e()}catch(t){console.error(t)}q.clear()}const K=new WeakMap,G=new Set;function He(e){const t=new Set,n=t.values();for(;e;){if(e.resolved=!1,e.deps){for(const o of e.deps)o.contexts.delete(e);e.deps.clear()}if(e.contexts)for(const o of e.contexts)G.has(o)||(t.add(o),e.contexts.delete(o));e.observe&&Ge(e.observe),e=n.next().value}}function _(e,t){let n=K.get(e);n||(n=new Map,K.set(e,n));let o=n.get(t);return o||(o={key:t,target:e,value:void 0,lastValue:void 0,resolved:!1,contexts:void 0,deps:void 0,observe:void 0},n.set(t,o)),o}function Ue(e){const t=K.get(e);return t?[...t.values()]:[]}let O=null;function R(e,t,n){const o=_(e,t);if(O&&(o.contexts||(o.contexts=new Set),O.deps||(O.deps=new Set),o.contexts.add(O),O.deps.add(o)),o.resolved)return o.value;const i=O;try{if(G.has(o))throw Error(`Circular get invocation is forbidden: '${t}'`);O=o,G.add(o),o.value=n(e,o.value),o.resolved=!0,O=i,G.delete(o)}catch(r){throw O=i,G.delete(o),O&&(O.deps.delete(o),o.contexts.delete(O)),r}return o.value}function de(e,t,n,o){const i=_(e,t),r=n(e,o,i.value);r!==i.value&&(i.value=r,He(i))}function Jt(e,t,n,o){const i=_(e,t);i.observe=()=>{const r=R(e,t,n);r!==i.lastValue&&(o(e,r,i.lastValue),i.lastValue=r)};try{i.observe()}catch(r){console.error(r)}return()=>{Ft(i.observe),i.observe=void 0,i.lastValue=void 0}}const pe=new Set;function Xt(e){pe.size||setTimeout(()=>{for(const t of pe)if(!t.contexts||t.contexts.size===0){if(t.deps)for(const o of t.deps)o.contexts.delete(t);K.get(t.target).delete(t.key)}pe.clear()}),pe.add(e)}function Ye(e,t){He(e),t.clearValue&&(e.value=void 0,e.lastValue=void 0),t.deleteEntry&&Xt(e)}function he(e,t,n={}){const o=_(e,t);Ye(o,n)}function Qe(e,t={}){const n=K.get(e);if(n)for(const o of n.values())Ye(o,t)}function Ze(e,t){return{get:t?n=>{const o=e(n),i=n.shadowRoot||n.attachShadow({mode:"open",delegatesFocus:e.delegatesFocus||!1});return()=>(o(n,i),i)}:n=>{const o=e(n);return()=>(o(n,n),n)},observe(n,o){o()}}}const et={string:(e,t,n)=>{const o=t?String(t):"";return o?e.setAttribute(n,o):e.removeAttribute(n),o},number:(e,t,n)=>{const o=Number(t);return e.setAttribute(n,o),o},boolean:(e,t,n)=>{const o=!!t;return o?e.setAttribute(n,""):e.removeAttribute(n),o},undefined:(e,t,n)=>{const o=typeof t,i=o!=="undefined"&&et[o];return i?i(e,t,n):(e.hasAttribute(n)&&e.removeAttribute(n),t)}},qt={string:(e,t)=>e.getAttribute(t),number:(e,t)=>Number(e.getAttribute(t))||0,boolean:(e,t)=>e.hasAttribute(t),undefined:(e,t)=>e.getAttribute(t)};function Kt(e,t){const n=typeof t.value,o=et[n],i=qt[n];if(!o)throw TypeError(`Invalid default value for '${e}' property - it must be a string, number, boolean or undefined: ${n}`);const r=X(e);return{get:(s,a)=>a===void 0?i(s,r)||t.value:a,set:(s,a)=>o(s,a,r),connect:n!=="undefined"?(s,a,f)=>(!s.hasAttribute(r)&&s[a]===t.value&&(s[a]=o(s,t.value,r)),t.connect&&t.connect(s,a,f)):t.connect,observe:t.observe}}const H=new WeakMap,me=new WeakMap;function Ne(e,t){if(t){const r=H.get(t);if(e===r)return t;for(const s of Object.keys(r))s!=="tag"&&delete t.prototype[s]}else t=class extends globalThis.HTMLElement{connectedCallback(){for(const s of t.settable){if(!hasOwnProperty.call(this,s))continue;const a=this[s];delete this[s],this[s]=a}const r=new Set;me.set(this,r),Ge(()=>{if(r===me.get(this)){for(const s of t.connects)r.add(s(this));for(const s of t.observers)r.add(s(this))}})}disconnectedCallback(){const r=me.get(this);for(const s of r)s&&s();me.delete(this),Qe(this)}};H.set(t,Object.freeze(e));const n=new Set,o=new Set,i=new Set;for(const r of Object.keys(e)){if(r==="tag")continue;let s=e[r];const a=typeof s;if(a==="function")r==="render"?s=Ze(s,!0):r==="content"?s=Ze(s):s={get:s};else if(a!=="object"||s===null)s={value:s};else if(s.set){if(hasOwnProperty.call(s,"value"))throw TypeError(`Invalid property descriptor for '${r}' property - it must not have 'value' and 'set' properties at the same time.`);const f=X(r),m=s.get||((h,l)=>l);s.get=(h,l)=>(l===void 0&&(l=s.set(h,h.getAttribute(f)||l)),m(h,l))}if(hasOwnProperty.call(s,"value"))s=Kt(r,s);else if(!s.get)throw TypeError(`Invalid descriptor for '${r}' property - it must contain 'value' or 'get' option`);s.set&&i.add(r),Object.defineProperty(t.prototype,r,{get:function(){return R(this,r,s.get)},set:s.set&&function(m){de(this,r,s.set,m)},enumerable:!0,configurable:!0}),s.connect&&n.add(f=>s.connect(f,r,()=>{he(f,r)})),s.observe&&o.add(f=>Jt(f,r,s.get,s.observe))}return t.connects=n,t.observers=o,t.settable=i,t}const U=new Map;function Gt(e){U.size||ue.then(()=>{fe(globalThis.document.body,t=>{if(U.has(t.constructor)){const n=U.get(t.constructor),o=H.get(t.constructor);t.disconnectedCallback();for(const i of Object.keys(o)){const r=typeof o[i],s=r!=="object"&&r!=="function"&&o[i]!==n[i];s&&t.removeAttribute(X(i)),he(t,i,{clearValue:s})}t.connectedCallback()}}),U.clear()}),U.set(e,H.get(e))}function tt(e){if(!e.tag)throw TypeError("Error while defining hybrids: 'tag' property with dashed tag name is required");const t=globalThis.customElements.get(e.tag);if(t){if(H.get(t))return Gt(t),Ne(e,t),e;throw TypeError(`Custom element with '${e.tag}' tag name already defined outside of the hybrids context`)}return globalThis.customElements.define(e.tag,Ne(e)),e}function Ht(e,{root:t="",prefix:n}={}){for(const o of Object.keys(e)){const i=e[o];if(!i.tag){const r=X([].concat(t).reduce((s,a)=>s.replace(a,""),o).replace(/^[./]+/,"").replace(/\//g,"-").replace(/\.[a-zA-Z]+$/,""));i.tag=n?`${n}-${r}`:r}tt(i)}return e}const nt=Object.freeze(Object.assign(tt,{compile:e=>Ne(e),from:Ht})),je=Symbol("store.connect"),S=new WeakMap,ge=new WeakMap,ot=new WeakSet;function Pe(e,t,n){if(n&&(S.set(n,null),ge.set(n,t)),S.set(t,e),e.storage.observe){const o=t&&e.isInstance(t)?t:null,i=n&&e.isInstance(n)?n:null;o!==i&&e.storage.observe(o,i)}return t}function Ut(e,t){return Object.keys(e).every(n=>e[n]===t[n])}function Yt(e,t,n){return Pe(e,t,n),e.invalidate&&(!n||ne(t)||!e.isInstance(n)||!Ut(t,n))&&e.invalidate(),t}function z(e,t,n,o=!0){return de(e,t,o?Yt:Pe,n),n}let be;function N(){return be||(be=Date.now(),ue.then(()=>{be=void 0})),be}const ye=new WeakMap;function Ce(e){let t=ye.get(e);return t||(t=N(),ye.set(e,t)),t}function Ae(e){return ye.set(e,N()),e}function rt(e){return ye.set(e,1),e}function Le(e){return globalThis.btoa(Array.from(e).reduce((t,n)=>Math.imul(31,t)+n.charCodeAt(0)|0,0))}const ke="hybrids:store:cache",Me={};let _e;function Qt(e,t){const n=`${ke}:${Le(JSON.stringify(e.model))}`;return Me[n]=N()+t,_e||(_e=Promise.resolve().then(()=>{const o=JSON.parse(globalThis.localStorage.getItem(ke))||{},i=N();for(const r of Object.keys(o))!Me[r]&&o[r]<i&&(globalThis.localStorage.removeItem(r),delete o[r]);globalThis.localStorage.setItem(ke,JSON.stringify({...o,...Me})),_e=null})),n}const Zt=/^\{.+\}$/;function it(e,t){typeof t=="function"&&(t={get:t});const n={cache:!0,loose:!1,...t};if(n.observe){const o=n.observe;if(typeof o!="function")throw TypeError(`Storage 'observe' property must be a function: ${typeof n.observe}`);n.observe=(i,r)=>{try{let s=r?r.id:i.id;if(Zt.test(s))try{s=JSON.parse(s)}catch{}o(s,i,r)}catch(s){console.error(s)}}}if(n.cache===!1||n.cache===0)n.validate=o=>!o||Ce(o)===N();else if(typeof n.cache=="number")n.validate=o=>!o||Ce(o)+n.cache>N();else{if(n.cache!==!0)throw TypeError(`Storage 'cache' property must be a boolean or number: ${typeof n.cache}`);n.validate=o=>Ce(o)!==1}if(n.get||(n.get=o=>{throw Z(Q(o))}),n.offline)try{const o=n.offline===!0,i=o?1e3*60*60*24*30:n.offline,r=Qt(e,i),s=JSON.parse(globalThis.localStorage.getItem(r))||{};let a;n.offline=Object.freeze({key:r,threshold:i,get:o?f=>hasOwnProperty.call(s,f)?JSON.parse(s[f][1]):null:f=>{if(hasOwnProperty.call(s,f)){const m=s[f];return m[0]+i<N()?(delete s[f],null):JSON.parse(m[1])}return null},set(f,m){return m?s[f]=[N(),JSON.stringify(m,function(l,c){if(c===this[""])return c;if(c&&typeof c=="object"){const p=S.get(c);if(p===e&&c.id===f)return String(c);if(p&&p.storage.offline)return p.list?c.map(d=>(we.get(p.model).storage.offline.set(d.id,d),`${d}`)):(p.storage.offline.set(c.id,c),`${c}`)}return c})]:delete s[f],a||(a=Promise.resolve().then(()=>{const h=N();for(const l of Object.keys(s))s[l][0]+i<h&&delete s[l];globalThis.localStorage.setItem(r,JSON.stringify(s)),a=null})),m}})}catch(o){console.error("Error while setup offline cache",o),n.offline=!1}return Object.freeze(n)}function en(e){return{get:e.enumerable?()=>{}:()=>e.create({}),set:e.enumerable?(t,n)=>n:(t,n)=>n===null?{id:t}:n,list:e.enumerable&&function(n){if(n)throw TypeError("Memory-based model definition does not support id");const o=[];for(const{key:i,value:r}of Ue(e))i!==e&&r&&!ne(r)&&o.push(i);return o},loose:!0}}function L(e,t){return Array.isArray(e)?ln(e[0],t):at(e,t)}function st(e,t){switch(e){case"string":return n=>n!=null?String(n):"";case"number":return Number;case"boolean":return Boolean;default:throw TypeError(`The value of the '${t}' must be a string, number or boolean: ${e}`)}}const tn=(e,t,n)=>t.state==="error"?{state:"error",error:t.value}:(t.error=!!n&&n.error,t);function k(e,t,n=e){return de(e,"state",tn,{state:t,value:n}),e}const nn=(e,t={state:"ready",value:e,error:!1})=>t;function Y(e){return R(e,"state",nn)}function lt(e){return e?(e^Math.random()*16>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,lt)}function on(e){if(typeof e!="function")throw TypeError(`The first argument must be a function: ${typeof e}`);return ot.add(e),e}const ct=new WeakMap;function rn(e,t,n){let o=n.model[t];ot.has(o)&&(o=o());let i=typeof o;if(o instanceof String||o instanceof Number||o instanceof Boolean){const r=ct.get(o);if(!r)throw TypeError(j(e,`You must use primitive ${typeof o.valueOf()} value for '${t}' property of the provided model definition`));o=o.valueOf(),i=typeof o,n.checks.set(t,r)}return{defaultValue:o,type:i}}function j(e,t){return`${t}

Model = ${JSON.stringify(e,null,2)}
`}const sn=Promise.resolve(),we=new WeakMap;function at(e,t){if(typeof e!="object"||e===null)throw TypeError(`Model definition must be an object: ${typeof e}`);let n=we.get(e);if(n&&!n.enumerable){if(t&&!n.nested)throw TypeError(j(e,"Provided model definition for nested object already used as a root definition"));if(!t&&n.nested)throw TypeError(j(e,"Nested model definition cannot be used outside of the parent definition"))}if(!n){const o=e[je];typeof o=="object"&&Object.freeze(o);let i;const r=hasOwnProperty.call(e,"id"),s=!!o,a=new Map,f={};Object.defineProperty(f,"toString",{value:function(){return this.id}});const m=Object.create(f);n={model:e,external:s,enumerable:r,nested:!r&&!s&&t,placeholder:l=>{const c=Object.create(m);return S.set(c,n),r&&(c.id=l),Object.freeze(c)},isInstance:l=>Object.getPrototypeOf(l)!==m,invalidate:()=>{i||(i=sn.then(()=>{he(n,n,{clearValue:!0}),i=null}))},checks:a},we.set(e,n),n.storage=it(n,o||en(n));const h=Object.keys(Object.freeze(e)).map(l=>{if(l!=="id"&&Object.defineProperty(m,l,{get(){throw Error(`Model instance in ${Y(this).state} state - use store.pending(), store.error(), or store.ready() guards`)},enumerable:!0}),l==="id"){if(e[l]!==!0)throw TypeError("The 'id' property in the model definition must be set to 'true' or not be defined");return(u,d,y)=>{let b;hasOwnProperty.call(d,"id")?b=Q(d.id):y?b=y.id:b=lt(),Object.defineProperty(u,"id",{value:b,enumerable:!0})}}const{defaultValue:c,type:p}=rn(e,l,n);switch(p){case"function":return u=>{Object.defineProperty(u,l,{get(){return R(this,l,()=>c(this))}})};case"object":{if(c===null)throw TypeError(`The value for the '${l}' must be an object instance: ${c}`);if(Array.isArray(c)){const y=typeof c[0];if(y!=="object"){if(y==="function"&&![String,Number,Boolean].includes(c[0]))throw TypeError(`The array item for the '${l}' must be one of the primitive types constructor: String, Number, or Boolean`);const w=y==="function"?c[0]:st(y,l),g=y==="function"?[]:Object.freeze(c.map(w));return(v,$,T)=>{if(hasOwnProperty.call($,l)){if(!Array.isArray($[l]))throw TypeError(`The value for '${l}' property must be an array: ${typeof $[l]}`);v[l]=Object.freeze($[l].map(w))}else T&&hasOwnProperty.call(T,l)?v[l]=T[l]:v[l]=g}}const b=L(c,!0);if(b.external&&n.storage.offline&&b.storage.offline&&b.storage.offline.threshold<n.storage.offline.threshold)throw Error(`External nested model for '${l}' property has lower offline threshold (${b.storage.offline.threshold} ms) than the parent definition (${n.storage.offline.threshold} ms)`);if(b.enumerable&&c[1]){const w=c[1];if(typeof w!="object")throw TypeError(`Options for '${l}' array property must be an object instance: ${typeof w}`);w.loose&&(n.contexts=n.contexts||new Set,n.contexts.add(L(c[0])))}return(w,g,v)=>{if(hasOwnProperty.call(g,l)){if(!Array.isArray(g[l]))throw TypeError(`The value for '${l}' property must be an array: ${typeof g[l]}`);w[l]=b.create(g[l],!0)}else w[l]=v&&v[l]||!b.enumerable&&b.create(c)||[]}}const d=L(c,!0);if(d.enumerable||d.external){if(n.storage.offline&&d.storage.offline&&d.storage.offline.threshold<n.storage.offline.threshold)throw Error(`External nested model for '${l}' property has lower offline threshold (${d.storage.offline.threshold} ms) than the parent definition (${n.storage.offline.threshold} ms)`);return(y,b,w)=>{let g;if(hasOwnProperty.call(b,l)){const v=b[l];if(typeof v!="object"||v===null)v!=null&&(g={id:v});else{const $=S.get(v);if($){if($.model!==c)throw TypeError("Model instance must match the definition");g=v}else{const T=_(d,b[l].id).value;g=d.create(v,T&&d.isInstance(T)?T:void 0),z(d,g.id,g)}}}else g=w&&w[l];if(g){const v=g.id;Object.defineProperty(y,l,{get(){return R(this,l,()=>P(c,v))},enumerable:!0})}else y[l]=void 0}}return(y,b,w)=>{hasOwnProperty.call(b,l)?y[l]=b[l]===null?d.create({}):d.create(b[l],w&&w[l]):y[l]=w?w[l]:d.create({})}}default:{const u=st(p,l);return(d,y,b)=>{hasOwnProperty.call(y,l)?d[l]=u(y[l]):b&&hasOwnProperty.call(b,l)?d[l]=b[l]:d[l]=c}}}});n.create=function(c,p){if(c===null)return null;if(typeof c!="object")throw TypeError(`Model values must be an object instance: ${c}`);const u=Object.create(f);for(const d of h)d(u,c,p);return S.set(u,n),xe.set(u,Ie),Object.freeze(u)},Object.freeze(m),Object.freeze(n)}return n}const ft=Object.getOwnPropertyNames(Array.prototype).reduce((e,t)=>(t==="length"||t==="constructor"||Object.defineProperty(e,t,{get(){throw Error(`Model list instance in ${Y(this).state} state - use store.pending(), store.error(), or store.ready() guards`)}}),e),[]),Re=new WeakMap;function ln(e,t){let n=Re.get(e);if(n&&!n.enumerable&&!t&&n.nested)throw TypeError(j(e,"Nested model definition cannot be used outside of the parent definition"));if(!n){const o=at(e),i=new Set;if(o.storage.loose&&i.add(o),!t){if(!o.enumerable)throw TypeError(j(e,"Provided model definition does not support listing (it must be enumerable - set `id` property to `true`)"));if(!o.storage.list)throw TypeError(j(e,"Provided model definition storage does not support `list` action"))}t=!o.enumerable&&!o.external&&t,n={list:!0,nested:t,model:e,contexts:i,enumerable:o.enumerable,external:o.external,placeholder:()=>{const r=Object.create(ft);return S.set(r,n),Object.freeze(r)},isInstance:r=>Object.getPrototypeOf(r)!==ft,create(r,s=!1){if(r===null)return null;const a=[];for(const f of r){let m=f;if(typeof f=="object"&&f!==null){m=f.id;const h=S.get(f);let l=f;if(h){if(h.model!==e)throw TypeError("Model instance must match the definition")}else{const c=o.enumerable&&_(o,f.id).value;l=o.create(f,c&&o.isInstance(c)?c:void 0),o.enumerable&&(m=l.id,z(o,m,l,s))}o.enumerable||a.push(l)}else if(!o.enumerable)throw TypeError(`Model instance must be an object: ${typeof f}`);if(o.enumerable){const h=a.length;Object.defineProperty(a,h,{get(){return R(this,h,()=>P(e,m))},enumerable:!0})}}return Object.defineProperties(a,{id:{value:r.id},toString:{value:function(){return this.id}}}),S.set(a,n),xe.set(a,Ie),Object.freeze(a)}},n.storage=Object.freeze({...it(n,{cache:o.storage.cache,get:!t&&(r=>o.storage.list(r))}),offline:o.storage.offline&&{threshold:o.storage.offline.threshold,get:r=>{const s=Q(r);let a=o.storage.offline.get(Le(String(s)));return a?(a=a.map(f=>o.storage.offline.get(f)),a.id=s,a):null},set:(r,s)=>{o.storage.offline.set(Le(String(Q(r))),s.map(a=>(o.storage.offline.set(a.id,a),a.id)))}}}),Re.set(e,Object.freeze(n))}return n}function cn(e,t){return t||N()}function Q(e){switch(typeof e){case"object":{const t={};for(const n of Object.keys(e).sort()){if(typeof e[n]=="object"&&e[n]!==null)throw TypeError(`You must use primitive value for '${n}' key: ${typeof e[n]}`);t[n]=e[n]}return JSON.stringify(t)}case"undefined":return;default:return String(e)}}const ut=new WeakSet;function Z(e,t){const n=Error(j(e,`Model instance ${t!==void 0?`with '${t}' id `:""}does not exist`));return ut.add(n),n}function ve(e,t,n){return n!==!1&&!ut.has(t)&&console.error(t),k(e,"error",t)}function P(e,t){const n=L(e);let o;if(n.enumerable){if(o=Q(t),!o&&!n.list&&!ee.get(n))throw TypeError(j(e,`Provided model definition requires non-empty id: "${o}"`))}else if(t!==void 0)throw TypeError(j(e,"Provided model definition does not support id"));const i=n.storage.offline,r=n.storage.validate,s=_(n,o);return s.value&&!r(s.value)&&(s.resolved=!1),R(n,o,(a,f)=>{if(f&&I(f))return f;let m=!0;if(n.contexts)for(const l of n.contexts)R(l,l,cn)===N()&&(m=!1);if(m&&f&&r(f))return f;const h=()=>f||i&&n.create(i.get(o))||n.placeholder(o);try{let l=n.storage.get(t);if(typeof l!="object"||l===null)throw i&&i.set(o,null),Z(e,o);if(l instanceof Promise)return l=l.then(p=>{if(typeof p!="object"||p===null)throw i&&i.set(o,null),Z(e,o);p.id!==o&&(p.id=o);const u=n.create(p);return i&&i.set(o,u),z(n,o,Ae(u))}).catch(p=>z(n,o,ve(h(),p))),k(h(),"pending",l);l.id!==o&&(l.id=o);const c=n.create(l);return i&&Promise.resolve().then(()=>{i.set(o,c)}),Pe(n,Ae(c),f)}catch(l){return Ae(ve(h(),l))}})}const ee=new WeakMap;function dt(e){const t=Object.keys(e),n=Error(`Model validation failed (${t.join(", ")}) - read the details from 'errors' property`);return n.errors=e,n}function te(e,t={}){let n=S.get(e);if(n===null&&(e=ge.get(e),n=S.get(e)),n===null)throw Error("Provided model instance has expired. Haven't you used stale value?");let o=!!n;if(n||(n=L(e)),n.nested)throw j(n.model,TypeError("Setting provided nested model instance is not supported, use the root model instance"));if(n.list)throw TypeError("Listing model definition does not support 'set' method");if(!n.storage.set)throw j(n.model,TypeError("Provided model definition storage does not support 'set' method"));if(!o&&!n.enumerable&&(o=!0,e=P(e)),o){const s=I(e);if(s)return s.then(a=>te(a,t))}const i=ee.get(n);let r;try{if(n.enumerable&&!o&&(!t||typeof t!="object"))throw TypeError(`Values must be an object instance: ${t}`);if(!i&&t&&hasOwnProperty.call(t,"id"))throw TypeError(`Values must not contain 'id' property: ${t.id}`);const s=n.create(t,o?e:void 0),a=t?Object.keys(t):[],f={},m=o&&i&&ne(e);let h=!1;if(s){for(const[c,p]of n.checks.entries()){if(a.indexOf(c)===-1&&(m&&m.errors&&m.errors[c]&&(h=!0,f[c]=m.errors[c]),i&&s[c]==n.model[c]))continue;let u;try{u=p(s[c],c,s)}catch(d){u=d}u!==!0&&u!==void 0&&(h=!0,f[c]=u||!0)}if(h&&!i)throw dt(f)}r=s?s.id:e.id;const l=Promise.resolve(n.storage.set(o?r:void 0,s,a)).then(c=>{const p=c===s?s:n.create(c);if(o&&p&&r!==p.id)throw TypeError(`Local and storage data must have the same id: '${r}', '${p.id}'`);let u=p?p.id:r;return h&&i&&k(p,"error",dt(f)),i&&o&&hasOwnProperty.call(c,"id")&&(!s||s.id!==e.id)?u=e.id:n.storage.offline&&n.storage.offline.set(u,p),z(n,u,p||ve(n.placeholder(u),Z(n.model,r),!1),!0)}).catch(c=>{throw c=c!==void 0?c:Error("Undefined error"),o&&k(e,"error",c),c});return o&&k(e,"pending",l),l}catch(s){return o&&k(e,"error",s),Promise.reject(s)}}function an(e,t){if(typeof t!="object")throw TypeError(`Values must be an object instance: ${t}`);let n=S.get(e);if(n===null&&(e=ge.get(e),n=S.get(e)),n===null)throw Error("Provided model instance has expired. Haven't you used stale value?");if(n===void 0){if(!t)throw TypeError("Values must be defined for usage with model definition");n=L(e),e=void 0}else if(t&&hasOwnProperty.call(t,"id"))throw TypeError(`Values must not contain 'id' property: ${t.id}`);if(n.list)throw TypeError("Listing model definition is not supported in sync method");const o=n.create(t,e),i=t?o.id:e.id;return z(n,i,o||ve(n.placeholder(i),Z(n.model,i),!1))}function ze(e,t=!0){if(typeof e!="object"||e===null)throw TypeError(`The first argument must be a model instance or a model definition: ${e}`);let n=S.get(e);if(n===null)throw Error("Provided model instance has expired. Haven't you used stale value from the outer scope?");if(n){const o=t&&n.storage.offline;o&&o.set(e.id,null),rt(e),he(n,e.id,{clearValue:t,deleteEntry:t})}else{if(!we.get(e)&&!Re.get(e[0]))throw Error("Model definition must be used before - passed argument is probably not a model definition");n=L(e);const o=t&&n.storage.offline;for(const i of Ue(n))o&&o.set(i.key,null),i.value&&rt(i.value);Qe(n,{clearValue:t,deleteEntry:t})}}function I(...e){let t=!1;const n=e.map(o=>{try{const{state:i,value:r}=Y(o);if(i==="pending")return t=!0,r}catch{}return Promise.resolve(o)});return t&&(e.length>1?Promise.all(n):n[0])}function pt(e,t){e=ge.get(e)||e,S.get(e)||(e=P(e,t));const n=I(e);if(!n){const o=ne(e);return o?Promise.reject(o):Promise.resolve(e)}return n.then(o=>pt(o))}function ne(e,t){if(e===null||typeof e!="object")return!1;const n=Y(e);if(t!==void 0){const o=typeof n.error=="object"&&n.error&&n.error.errors;return t===null?!o&&n.error:o[t]}return n.error}function We(...e){return e.length>0&&e.every(t=>{const n=S.get(t);return!!(n&&n.isInstance(t))})}function ht(e,t){return e={...e,...t},delete e.id,e}function fn(e,t={}){const n=S.get(e);if(!n||!ee.has(n))throw TypeError(`Provided model instance is not a draft: ${e}`);if(I(e))throw Error("Model draft in pending state");const o=ee.get(n);let i;if(_(o,e.id).value){const r=P(o.model,e.id);i=Promise.resolve(I(r)||r).then(s=>te(s,ht(e,t)))}else i=te(o.model,ht(e,t));return i=i.then(r=>(k(e,"ready"),te(e,r).then(()=>r))).catch(r=>(k(e,"error",r),Promise.reject(r))),k(e,"pending",i),i}function un(e,t){return!!e||`${t} is required`}function dn(e,t=un,n=""){switch(typeof e){case"string":e=new String(e);break;case"number":e=new Number(e);break;case"boolean":e=new Boolean(e);break;default:throw TypeError(`Default value must be a string, number or boolean: ${typeof e}`)}let o;if(t instanceof RegExp)o=i=>t.test(i)||n;else if(typeof t=="function")o=(...i)=>{const r=t(...i);return r!==!0&&r!==void 0&&n||r};else throw TypeError(`The second argument must be a RegExp instance or a function: ${typeof t}`);return ct.set(e,o),e}function pn(e){const t=S.get(e),n=Object.freeze(Object.create(e));return S.set(n,t),n}function Ie(e,t={}){const n=L(e);if(t.id!==void 0&&typeof t.id!="function"){const i=t.id;t.id=r=>r[i]}if(t.id&&!n.enumerable)throw TypeError("Store factory for singleton model definition does not support 'id' option");let o;if(t.draft){if(n.list)throw TypeError("Draft mode is not supported for listing model definition");o=L({...e,[je]:{get(i){const r=P(n.model,i);return I(r)||r},set(i,r){return r===null?{id:i}:r}}}),ee.set(o,n),e=o.model}return!t.id&&n.enumerable&&!n.list?{get(i,r){const a=S.get(r)!==void 0?r.id:r;if(o&&r==null){const f=o.create({},{id:void 0});return z(o,void 0,f,!1),P(e,void 0)}return r?P(e,a):void 0},set:(i,r)=>r,connect:o?(i,r)=>()=>{const s=i[r];s&&s.id&&ze(s,!0)}:void 0}:{get:(i,r)=>{const s=S.get(r),a=t.id&&t.id(i)||(s!==void 0?r.id:r);if(o&&!a&&r==null){const m=o.create({});return z(o,void 0,m,!1),P(e,void 0)}if(!n.list&&n.enumerable&&a===void 0)return;const f=P(e,a);if(f!==r&&We(r)&&!We(f)){const m=pn(r);return de(m,"state",()=>Y(f)),m}return f},set:!t.id&&n.list||o&&!n.enumerable?(i,r)=>r:void 0,connect:o&&n.enumerable?(i,r)=>()=>{const s=i[r];s&&s.id&&ze(s,!0)}:void 0}}const D=Object.freeze(Object.assign(Ie,{connect:je,get:P,set:te,sync:an,clear:ze,pending:I,error:ne,ready:We,submit:fn,value:dn,resolve:pt,ref:on})),oe=new WeakMap;function W(e){let t=oe.get(e);return t||(oe.set(e,t={}),t)}function Te(e){let t;for(;e&&(t=W(e))&&t.endNode;)e=t.endNode;return e}function re(e){if(e.nodeType===globalThis.Node.TEXT_NODE){const t=oe.get(e);if(t&&t.startNode){const n=Te(t.endNode);let o=t.startNode;const i=n.nextSibling;for(;o;){const r=o.nextSibling;o.parentNode.removeChild(o),o=r!==i&&r}oe.set(e,{})}}else{let t=e.childNodes[0];for(;t;)e.removeChild(t),t=e.childNodes[0];oe.set(e,{})}}const hn=Date.now(),M=(e=0)=>`H-${hn}-${e}`,De=!!(globalThis.document&&globalThis.document.adoptedStyleSheets),Be=/^\d+$/,mn={block:(e,t)=>({display:"block","text-align":t}),inline:({display:e})=>({display:`inline${e?`-${e}`:""}`}),contents:{display:"contents"},hidden:{display:"none"},...["row","row-reverse","column","column-reverse"].reduce((e,t)=>(e[t]=(n,o="nowrap")=>({display:"flex","flex-flow":`${t} ${o}`}),e),{}),grow:(e,t=1)=>({"flex-grow":t}),shrink:(e,t=1)=>({"flex-shrink":t}),basis:(e,t)=>({"flex-basis":E(t)}),order:(e,t=0)=>({order:t}),grid:(e,t="1",n="",o="",i="")=>({display:"grid",...["columns","rows"].reduce((r,s)=>{const a=s==="columns"?t:n;return r[`grid-template-${s}`]=a&&a.split("|").map(f=>f.match(Be)?`repeat(${f}, minmax(0, 1fr))`:E(f)).join(" "),r},{}),"grid-auto-flow":`${o} ${i&&"dense"}`}),area:(e,t="",n="")=>({"grid-column":t.match(Be)?`span ${t}`:t,"grid-row":n.match(Be)?`span ${n}`:n}),gap:(e,t=1,n="")=>({"column-gap":E(t),"row-gap":E(n||t)}),items:(e,t="start",n="")=>({"place-items":`${t} ${n}`}),content:(e,t="start",n="")=>({"place-content":`${t} ${n}`}),self:(e,t="start",n="")=>({"place-self":`${t} ${n}`}),center:{"place-items":"center","place-content":"center"},size:(e,t,n=t)=>({width:E(t),height:E(n),"box-sizing":"border-box"}),width:(e,t,n,o)=>({width:E(t),"min-width":E(n),"max-width":E(o),"box-sizing":"border-box"}),height:(e,t,n,o)=>({height:E(t),"min-height":E(n),"max-height":E(o),"box-sizing":"border-box"}),ratio:(e,t)=>({"aspect-ratio":t}),overflow:(e,t="hidden",n="")=>{const o=n?`-${t}`:"",i=n||t;return{[`overflow${o}`]:i,...i==="scroll"?{"flex-grow":e["flex-grow"]||1,"flex-basis":0,"overscroll-behavior":"contain","--webkit-overflow-scrolling":"touch"}:{}}},margin:(e,t="1",n,o,i)=>t.match(/top|bottom|left|right/)?{[`margin-${t}`]:E(n||"1")}:{margin:`${E(t)} ${E(n)} ${E(o)} ${E(i)}`},padding:(e,t="1",n,o,i)=>t.match(/top|bottom|left|right/)?{[`padding-${t}`]:E(n||"1")}:{padding:`${E(t)} ${E(n)} ${E(o)} ${E(i)}`},absolute:{position:"absolute"},relative:{position:"relative"},fixed:{position:"fixed"},sticky:{position:"sticky"},static:{position:"static"},inset:(e,t=0)=>{const n=E(t);return{top:n,right:n,bottom:n,left:n}},top:(e,t=0)=>({top:E(t)}),bottom:(e,t=0)=>({bottom:E(t)}),left:(e,t=0)=>({left:E(t)}),right:(e,t=0)=>({right:E(t)}),layer:(e,t=1)=>({"z-index":t}),"":(e,t,...n)=>{if(n.length<2)throw new Error("Generic rule '::' requires at least two arguments, eg.: ::[property]:[name]");return{[n[n.length-2]]:`var(--${n.join("-")})`}},view:(e,t)=>({"view-transition-name":t})},gn={min:"min-content",max:"max-content",fit:"fit-content",full:"100%"},bn={portrait:"orientation: portrait",landscape:"orientation: landscape"};function E(e){return e=gn[e]||e,/^-?\d+(\.\d+)*$/.test(String(e))?`${e*8}px`:e||""}let F;function mt(){if(F)return F;if(De)F=new globalThis.CSSStyleSheet;else{const e=globalThis.document.createElement("style");e.appendChild(globalThis.document.createTextNode("")),globalThis.document.head.appendChild(e),F=e.sheet}return F.insertRule(":host([hidden]) { display: none; }"),F}const gt=new WeakMap;let Fe=new WeakSet;function yn(e){const t=e.getRootNode();if(Fe.has(t))return;const n=mt();if(De)t.adoptedStyleSheets=[...t.adoptedStyleSheets,n];else{if(t===globalThis.document)return;let o=gt.get(t);o||(o=globalThis.document.createElement("style"),t.appendChild(o),gt.set(t,o));let i="";for(let r=0;r<n.cssRules.length;r++)i+=n.cssRules[r].cssText;o.textContent=i}Fe.add(t)}const bt=new Map;function yt(e,t,n,o){let i=bt.get(e);i||(i=`l-${Math.random().toString(36).substr(2,5)}`,bt.set(e,i)),De||(Fe=new WeakSet);const r=mt(),[s,a=""]=t.split("@"),f=Object.entries(n.replace(/\s+/g," ").trim().split(" ").reduce((h,l)=>{const[c,...p]=l.split(":"),u=mn[c];if(!u)throw TypeError(`Unsupported layout rule: '${c}'`);return Object.assign(h,typeof u=="function"?u(h,...p.map(d=>d.match(/--.*/)?`var(${d})`:d)):u)},{})).reduce((h,[l,c])=>c!==void 0&&c!==""?h+`${l}: ${c};`:h,""),m=a.split(":").reduce((h,l)=>l===""?h:h+` and (${bn[l]||`min-width: ${l}`})`,"@media screen");if(o){const h=`:host(.${i}-s${s})`,l=`:where(.${i}-c${s})`;[h,l].forEach(c=>{r.insertRule(a?`${m} { ${c} { ${f} } }`:`${c} { ${f} }`,r.cssRules.length-1)})}else{const h=`.${i}${s}`;r.insertRule(a?`${m} { ${h} { ${f} } }`:`${h} { ${f} }`,r.cssRules.length-1)}return i}const Ve=new WeakMap;function wn(e,t){const n=W(e),o=n.startNode,i=Te(n.endNode);t.parentNode.insertBefore(e,t.nextSibling);let r=e,s=o;for(;s;){const a=s.nextSibling;r.parentNode.insertBefore(s,r.nextSibling),r=s,s=a!==i.nextSibling&&a}}function vn(e,t,n,o,i){let r=Ve.get(t);const s=n.map((h,l)=>({id:hasOwnProperty.call(h,"id")?h.id:l,value:h,placeholder:null,available:!0}));if(Ve.set(t,s),r){const h=new Set;for(const l of s)h.add(l.id);r=r.filter(l=>h.has(l.id)?!0:(re(l.placeholder),l.placeholder.parentNode.removeChild(l.placeholder),!1))}let a=t;const f=n.length-1,m=W(t);for(let h=0;h<s.length;h+=1){const l=s[h];let c;if(r){for(let p=0;p<r.length;p+=1)if(r[p].available&&r[p].id===l.id){c=r[p];break}}c?(c.available=!1,l.placeholder=c.placeholder,l.placeholder.previousSibling!==a&&wn(l.placeholder,a),c.value!==l.value&&o(e,l.placeholder,l.value,c.value,i)):(l.placeholder=globalThis.document.createTextNode(""),a.parentNode.insertBefore(l.placeholder,a.nextSibling),o(e,l.placeholder,l.value,void 0,i)),a=Te(W(l.placeholder).endNode||l.placeholder),h===0&&(m.startNode=l.placeholder),h===f&&(m.endNode=a)}if(r)for(const h of r)h.available&&(re(h.placeholder),h.placeholder.parentNode.removeChild(h.placeholder))}function Tn(e,t,n){re(t);const o=W(t);o.startNode=o.endNode=n,t.parentNode.insertBefore(n,t.nextSibling)}function wt(e){const t=typeof e;if(t==="object"){if(Array.isArray(e))return"array";if(e instanceof globalThis.Node)return"node"}return t}function ie(e,t,n,o,i){const r=wt(n),s=wt(o);switch(s!=="undefined"&&r!==s&&(r!=="function"&&re(t),s==="array"?Ve.delete(t):s!=="node"&&s!=="function"&&(t.textContent="")),r){case"array":vn(e,t,n,ie,i);break;case"node":Tn(e,t,n);break;case"function":i&&(n.useLayout=!0),n(e,t);break;default:t.textContent=r==="number"||n?n:""}}const Je=new WeakMap;function $n(e){return(t,n,o,i)=>{if(i){const r=Je.get(n);n.removeEventListener(e,r.get(i),i.options!==void 0?i.options:!1)}if(o){if(typeof o!="function")throw Error(`Event listener must be a function: ${typeof o}`);let r=Je.get(n);r||(r=new WeakMap,Je.set(n,r));const s=o.bind(null,t);r.set(o,s),n.addEventListener(e,s,o.options!==void 0?o.options:!1)}}}function En(e,t=new Set){if(Array.isArray(e))for(const n of e)n&&t.add(n);else if(e!==null&&typeof e=="object")for(const[n,o]of Object.entries(e))n&&o&&t.add(n);else e&&t.add(e);return t}const vt=new WeakMap;function Sn(e,t,n){const o=vt.get(t)||new Set,i=En(n);vt.set(t,i);for(const r of i)t.classList.add(r),o.delete(r);for(const r of o)t.classList.remove(r)}const Tt=new WeakMap;function xn(e,t,n){if(n===null||typeof n!="object")throw TypeError(`Style value must be an object in ${ae(t)}:`,n);const o=Tt.get(t)||new Map,i=new Map;for(const r of Object.keys(n)){const s=X(r),a=n[r];!a&&a!==0?t.style.removeProperty(s):t.style.setProperty(s,a),i.set(s,a),o.delete(s)}for(const r of o.keys())t.style[r]="";Tt.set(t,i)}function On(e,t,n){if(t.substr(0,2)==="on"){const o=t.substr(2);return $n(o)}switch(e){case"class":return Sn;case"style":return xn;default:{let o=!1;return(i,r,s)=>{if(o=o||!n&&!(r instanceof globalThis.SVGElement)&&t in r,o)r[t]=s;else if(s===!1||s===void 0||s===null)r.removeAttribute(e);else{const a=s===!0?"":String(s);r.setAttribute(e,a)}}}}}const $t=M("(\\d+)"),se=new RegExp(`^${$t}$`),V=new RegExp($t,"g"),Nn=/^[^A-Za-z]+$/;function jn(e){let t=e[0],n=!1;for(let o=1;o<e.length;o+=1)n=n||e[o-1].match(/<\s*(table|tr|thead|tbody|tfoot|colgroup)([^<>]|"[^"]*"|'[^']*')*>\s*$/),t+=(n?`<!--${M(o-1)}-->`:M(o-1))+e[o],n=n&&!e[o].match(/<\/\s*(table|tr|thead|tbody|tfoot|colgroup)\s*>/);return t}function Pn(e){return e.replace(/\s*=\s*['"]*$/g,"").split(/\s+/).pop()}function Et(e){return globalThis.document.createTreeWalker(e,globalThis.NodeFilter.SHOW_ELEMENT|globalThis.NodeFilter.SHOW_TEXT|globalThis.NodeFilter.SHOW_COMMENT,null,!1)}function Cn(e,t=0){e=e.replace(/(^[\n\s\t ]+)|([\n\s\t ]+$)+/g,"");let n=e.indexOf(`
`);if(n>-1){let o=0-t-2;for(n+=1;e[n]===" "&&n<e.length;n+=1)o+=1;return e.replace(/\n +/g,i=>i.substr(0,Math.max(i.length-o,1)))}return e}function St(e,t){const n=M(t);return`${Cn(e).split(`
`).filter(i=>i).map(i=>{const r=i.indexOf(n);return r>-1?`| ${i}
--${"-".repeat(r)}${"^".repeat(6)}`:`| ${i}`}).join(`
`).replace(V,"${...}")}`}const xt=new Map,Ot=new WeakMap;function An(e,t){const n=Ot.get(e);if(!n&&!t)return;const o=t&&t.map(r=>{let s=r;return s instanceof globalThis.CSSStyleSheet||(s=xt.get(r),s||(s=new globalThis.CSSStyleSheet,s.replaceSync(r),xt.set(r,s))),s});let i;if(n){if(o&&o.length===n.length&&o.every((r,s)=>r===n[s]))return;i=e.adoptedStyleSheets.filter(r=>!n.includes(r))}o&&(i=(i||e.adoptedStyleSheets).concat(o)),e.adoptedStyleSheets=i,Ot.set(e,o)}const Xe=new WeakMap;function Nt(e,t){let n=Xe.get(e);if(t){(!n||n.parentNode!==e)&&(n=globalThis.document.createElement("style"),Xe.set(e,n),e=Te(e),e.nodeType===globalThis.Node.TEXT_NODE?e.parentNode.insertBefore(n,e.nextSibling):e.appendChild(n));const o=[...t].join(`
/*------*/
`);n.textContent!==o&&(n.textContent=o)}else n&&(n.parentNode.removeChild(n),Xe.set(e,null))}const jt=new WeakMap;function Ln(e,t){let n=jt.get(e);n||(n=e.adoptedStyleSheets?An:Nt,jt.set(e,n)),n(e,t)}function kn(e,t,n,o){let i=globalThis.document.createElement("template");const r={},s=n?e:jn(e);if(i.innerHTML=t?`<svg>${s}</svg>`:s,t){const u=i.content.firstChild;i.content.removeChild(u);for(const d of Array.from(u.childNodes))i.content.appendChild(d)}let a;const f=i.content.children[0];if(f instanceof globalThis.HTMLTemplateElement){for(const u of Array.from(f.attributes)){const d=u.value.trim();if(d&&u.name.startsWith("layout")){if(d.match(V))throw Error("Layout attribute cannot contain expressions");a=yt(f,u.name.substr(6),d,!0)}}if(a!==void 0&&i.content.children.length>1)throw Error("Template, which uses layout system must have only the '<template>' root element");o=a||f.hasAttribute("layout"),i=f}const m=Et(i.content),h=[];let l=0,c=null;for(;m.nextNode();){let u=m.currentNode;if(c&&!c.contains(u)&&(c=null),u.nodeType===globalThis.Node.COMMENT_NODE&&se.test(u.textContent)&&(u.parentNode.insertBefore(globalThis.document.createTextNode(u.textContent),u.nextSibling),m.nextNode(),u.parentNode.removeChild(u),u=m.currentNode),u.nodeType===globalThis.Node.TEXT_NODE){let d=u.textContent;const y=d.match(se);if(y)u.textContent="",r[y[1]]=[l,ie];else{if(Un()&&!n&&!c&&!d.match(/^\s*$/)){let w;const g=d.trim(),v=g.replace(/\s+/g," ").replace(V,($,T)=>(T=Number(T),w===void 0&&(w=T),`\${${T-w}}`));if(!v.match(Nn)){let $=u.previousSibling&&u.previousSibling.nodeType===globalThis.Node.COMMENT_NODE?u.previousSibling:"";$&&($.parentNode.removeChild($),l-=1,$=($.textContent.split("|")[1]||"").trim().replace(/\s+/g," "));const T=Yn(v,$).replace(/\${(\d+)}/g,(C,A)=>M(Number(A)+w));d=d.replace(g,T),u.textContent=d}}const b=d.match(V);if(b){let w=u;b.reduce((g,v)=>{const[$,T]=g.pop().split(v);return $&&g.push($),g.push(v),T&&g.push(T),g},[d]).forEach((g,v)=>{v===0?w.textContent=g:(w=w.parentNode.insertBefore(globalThis.document.createTextNode(g),w.nextSibling),m.currentNode=w,l+=1);const $=w.textContent.match(se);$&&(w.textContent="",r[$[1]]=[l,ie])})}}}else if(u.nodeType===globalThis.Node.ELEMENT_NODE){if(!c&&(u.getAttribute("translate")==="no"||u.tagName.toLowerCase()==="script"||u.tagName.toLowerCase()==="style")&&(c=u),Oe){const d=u.tagName.toLowerCase();d.match(/.+-.+/)&&!globalThis.customElements.get(d)&&!h.includes(d)&&h.push(d)}for(const d of Array.from(u.attributes)){const y=d.value.trim(),b=d.name;if(o&&b.startsWith("layout")&&y){if(y.match(V))throw Error("Layout attribute cannot contain expressions");const g=yt(u,b.substr(6),y);u.removeAttribute(b),u.classList.add(g);continue}const w=y.match(se);if(w){const g=Pn(e[w[1]]);r[w[1]]=[l,On(b,g,t)],u.removeAttribute(d.name)}else{const g=y.match(V);if(g){const v=`attr__${b}`;for(const[$,T]of g.entries()){const[,C]=T.match(se);let A=!1;r[C]=[l,(le,x,B)=>{const ce=W(x);ce[v]=(ce[v]||y).replace(T,B??""),(g.length===1||$+1===g.length)&&(A=A||!t&&!(x instanceof globalThis.SVGElement)&&b in x,A?x[b]=ce[v]:x.setAttribute(b,ce[v]),ce[v]=void 0)}]}d.value=""}}}}l+=1}Oe&&h.length&&console.warn(`Not defined ${h.map(u=>`<${u}>`).join(", ")} element${h.length>1?"s":""} found in the template:
${St(s,-1)}`);const p=Object.keys(r);return function(d,y,b,{styleSheets:w}){let g=W(y);if(i!==g.template){const v=globalThis.document.importNode(i.content,!0),$=Et(v),T=[];let C=0,A=0,le=r[p[A]];for(;$.nextNode();){const x=$.currentNode;for(;le&&le[0]===C;)T.push({index:p[A],node:x,fn:le[1]}),A+=1,le=r[p[A]];C+=1}if(g.hostLayout&&d.classList.remove(g.hostLayout),re(y),g=W(y),g.template=i,g.markers=T,y.nodeType===globalThis.Node.TEXT_NODE){Nt(y),g.startNode=v.childNodes[0],g.endNode=v.childNodes[v.childNodes.length-1];let x=y,B=v.childNodes[0];for(;B;)y.parentNode.insertBefore(B,x.nextSibling),x=B,B=v.childNodes[0]}else{if(o){const x=`${a}-${d===y?"c":"s"}`;d.classList.add(x),g.hostLayout=x}y.appendChild(v)}o&&yn(y)}Ln(y,w);for(const v of g.markers){const $=b[v.index],T=g.prevArgs&&g.prevArgs[v.index];if(!(g.prevArgs&&$===T))try{v.fn(d,v.node,$,T,o)}catch(C){throw console.error(`Error while updating template expression in ${ae(d)}:
${St(s,v.index)}`),C}}g.prevArgs=b}}const qe=new WeakMap;function Mn(e,t,n=200){return function o(i,r){const s=o.useLayout;let a;t&&(a=setTimeout(()=>{a=void 0,ie(i,r,t,void 0,s)},n)),qe.set(r,e),e.then(f=>{a&&clearTimeout(a),qe.get(r)===e&&(ie(i,r,f,t&&!a?t:void 0,s),qe.set(r,null))})}}function Pt({target:e,detail:t},n){let o;switch(e.type){case"radio":case"checkbox":o=e.checked&&e.value;break;case"file":o=e.files;break;default:o=t&&hasOwnProperty.call(t,"value")?t.value:e.value}n(o)}function _n(e,t){return e.split(".").reverse().reduce((n,o)=>n?{[o]:n}:{[o]:t},null)}const Ct=new Map;function Rn(e,t){if(!e)throw Error(`The first argument must be a property name or an object instance: ${e}`);if(typeof e=="object"){if(t===void 0)throw Error("For model instance property the second argument must be defined");const o=xe.get(e);if(!o)throw Error("Provided object must be a model instance of the store");return t===null?()=>{o.set(e,null)}:(i,r)=>{Pt(r,s=>{o.set(e,_n(t,s))})}}if(arguments.length===2)return o=>{o[e]=t};let n=Ct.get(e);return n||(n=(o,i)=>{Pt(i,r=>{o[e]=r})},Ct.set(e,n)),n}let $e;const zn=globalThis.document&&globalThis.document.startViewTransition!==void 0&&function(t){return function n(o,i){if($e){console.warn(`${ae(o)}: view transition already started in ${ae($e)}`),t(o,i);return}t.useLayout=n.useLayout,$e=o,globalThis.document.startViewTransition(()=>(t(o,i),ue.then(()=>{$e=void 0})))}}||(e=>e),Wn=Object.freeze(Object.defineProperty({__proto__:null,resolve:Mn,set:Rn,transition:zn},Symbol.toStringTag,{value:"Module"}));function In(e){return this.id=e,this}function Dn(...e){return this.styleSheets=this.styleSheets||[],this.styleSheets.push(...e),this}function Bn(e,...t){this.styleSheets=this.styleSheets||[];let n=e[0];for(let o=1;o<e.length;o++)n+=(t[o-1]!==void 0?t[o-1]:"")+e[o];return this.styleSheets.push(n),this}function Fn(e){return this.plugins=this.plugins||[],this.plugins.push(e),this}const Vn=Object.freeze(Object.defineProperty({__proto__:null,css:Bn,key:In,style:Dn,use:Fn},Symbol.toStringTag,{value:"Module"})),Jn=M(),Xn=M("svg"),qn=M("msg"),Kn=M("layout"),At=new Map;function Gn(e,t,n,o){function i(r,s=r){let a=o?e+qn:e.join(Jn);n&&(a+=Xn);const f=i.useLayout;f&&(a+=Kn);let m=At.get(a);m||(m=kn(e,n,o,f),At.set(a,m)),i.plugins?i.plugins.reduce((h,l)=>l(h),()=>m(r,s,t,i))(r,s):m(r,s,t,i)}return Object.assign(i,Vn)}function Ee(e,...t){return Gn(e,t,!1,!1)}Object.freeze(Object.assign(Ee,Wn));const Se=new Map,Lt=new Map;let kt=null;const Hn=(()=>{let e;try{e=globalThis.navigator.languages||[globalThis.navigator.language]}catch{e=[]}return e.reduce((t,n)=>{const o=n.split("-")[0];return t.add(n),n!==o&&t.add(o),t},new Set)})();function Un(){return kt!==null||Se.size}const Mt=new Map;function Yn(e,t,n=[]){e=e.trim().replace(/\s+/g," "),t=t.trim();const o=`${e} | ${t}`;let i=Lt.get(o);if(!i){if(Se.size)for(const r of Hn){const s=Se.get(r);if(s&&(i=s[o]||s[e],i)){if(i=i.message,typeof i=="object"){let a=Mt.get(r);a||(a=new Intl.PluralRules(r),Mt.set(r,a));const f=i;i=m=>m===0&&f.zero||f[a.select(m)]||f.other||""}break}}i||i||(i=e,(Se.size||kt)&&Oe&&console.warn(`Missing translation: "${e}"${t?` [${t}]`:""}`)),Lt.set(o,i)}return typeof i=="function"?i(n[0]):i}var Qn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ke={exports:{}};(function(e,t){(function(n,o){o(t)})(Qn,function(n){const o=()=>{var c;return!!(!((c=navigator.mediaDevices)===null||c===void 0)&&c.getDisplayMedia)};/*! *****************************************************************************
  	    Copyright (c) Microsoft Corporation.

  	    Permission to use, copy, modify, and/or distribute this software for any
  	    purpose with or without fee is hereby granted.

  	    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  	    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  	    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  	    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  	    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  	    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  	    PERFORMANCE OF THIS SOFTWARE.
  	    ***************************************************************************** */function i(c,p,u,d){function y(b){return b instanceof u?b:new u(function(w){w(b)})}return new(u||(u=Promise))(function(b,w){function g(T){try{$(d.next(T))}catch(C){w(C)}}function v(T){try{$(d.throw(T))}catch(C){w(C)}}function $(T){T.done?b(T.value):y(T.value).then(g,v)}$((d=d.apply(c,p||[])).next())})}const r=c=>{const p=document.createElement("video");return p.autoplay=!0,p.muted=!0,p.playsInline=!0,p.srcObject=c,p.setAttribute("style","position:fixed;top:0;left:0;pointer-events:none;visibility:hidden;"),p},s=c=>{var p,u,d;const y=(p=c.srcObject)===null||p===void 0?void 0:p.getTracks()[0].getSettings(),b=document.createElement("canvas");b.width=(u=y==null?void 0:y.width)!==null&&u!==void 0?u:0,b.height=(d=y==null?void 0:y.height)!==null&&d!==void 0?d:0;const w=b.getContext("2d");return w==null||w.drawImage(c,0,0),b},a=c=>{const p=document.createElement("audio");p.loop=!1,p.src=c,p.play(),p.remove()},f=(c=300)=>new Promise(p=>{setTimeout(p,c)}),m=c=>{var p;const u=(p=c.srcObject)===null||p===void 0?void 0:p.getTracks();u==null||u.forEach(d=>d.stop()),c.srcObject=null,c.remove()},h=c=>i(void 0,void 0,void 0,function*(){return yield f(),document.hasFocus()?c:h(c)}),l=({onCaptureEnd:c,onCaptureStart:p,quality:u=.7,type:d="image/jpeg",soundEffectUrl:y}={})=>i(void 0,void 0,void 0,function*(){return yield p==null?void 0:p(),navigator.mediaDevices.getDisplayMedia({preferCurrentTab:!0,video:{frameRate:30}}).then(h).then(b=>i(void 0,void 0,void 0,function*(){const w=r(b);document.body.appendChild(w),y&&a(y),yield f();const g=s(w),v=g.toDataURL(d,u);return m(w),g.remove(),yield c==null?void 0:c(),v}))});n.checkIfBrowserSupported=o,n.takeScreenshot=l,Object.defineProperty(n,"__esModule",{value:!0})})})(Ke,Ke.exports);var _t=Ke.exports;const Rt={name:"Name",desc:"Description",expectedBehaviour:"Expected Behaviour"},zt=e=>t=>({create:()=>nt({...e,render:t})}),Wt=D({name:"",desc:""}),It=(e,t)=>{D.set(Wt,{[t.target.name]:t.target.value})},Zn=zt({tag:"lunar-bug-tool-textarea",name:"",value:""})(({value:e,name:t})=>Ee`
    <div>
      <label>${Rt[t]}</label>
      <textarea
        type="text"
        name="${t}"
        value="${e}"
        oninput="${It}"
      ></textarea>
    </div>
  `.css`
      label {
        display: block;
        color: white;
      }
      textarea {
        display: block;
        margin-bottom: 1rem;
      }
    `),eo=zt({tag:"lunar-bug-tool-input",name:"",value:""})(({value:e,name:t})=>Ee`
    <div>
      <label>${Rt[t]}</label>
      <input
        type="text"
        name="${t}"
        value="${e}"
        oninput="${It}"
      />
    </div>
  `.css`
    label {
      display: block;
      color: white;
    }
    input {
      display: block;
      margin-bottom: 1rem;
    }
  `),Dt="4a3fb7dc39032a123e911f41fc0c17e3",Bt="ATTA9c52ab7e727e26698f5ef71b9c2a1102cf0e598221b773cbfd549376ddc516661169EF54",to="https://api.trello.com/1",no=`key=${Dt}&token=${Bt}`;function oo(){const e=`
  **Name:** ${D.name}
  **Description:** ${D.desc}
  **Expected Behaviour:** ${D.expectedBehaviour}
  `;return{...D.get(Wt),desc:e,pos:"bottom"}}function ro(e){return fetch(e).then(t=>t.blob()).then(t=>new File([t],"Screenshot",{type:"image/png"}))}function io(e,t){const n=new FormData;n.append("name","Screenshot"),n.append("file",t),n.append("mimeType","image/png"),n.append("key",Dt),n.append("token",Bt);const o=new XMLHttpRequest;o.responseType="json",o.onreadystatechange=function(){o.readyState===4&&console.log(`Successfully uploaded at: ${o.response.date}`)},o.open("POST",`https://api.trello.com/1/cards/${cardId}/attachments/`),o.send(n)}function so(e,t){t.preventDefault();const n=`${to}/cards?idList=${e.idlist}&${no}`,o=oo();fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...D.get(o)})}).then(i=>i.json()).then(i=>{_t.checkIfBrowserSupported()&&_t.takeScreenshot().then(ro).then(r=>{console.log(r),io(i.id,r)})})}nt({tag:"lunar-bug-tool",idlist:"",render:()=>Ee`
    <div class="lunar-bug-tool">
      <h4>Report a bug</h4>
      <form onsubmit="${so}">
        <lunar-bug-tool-input name="name"></lunar-bug-tool-input>
        <lunar-bug-tool-textarea name="desc"></lunar-bug-tool-textarea>
        <lunar-bug-tool-textarea
          name="expectedBehaviour"
        ></lunar-bug-tool-textarea>

        <button>Submit</button>
      </form>
    </div>
  `.css`
    form {
      margin: .5rem 0;
    }

    .lunar-bug-tool {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      padding: 0 1rem .5rem;
      font-family: 'Gotham Rounded', Arial, sans-serif;
      background: linear-gradient(45deg, #272c40, #485b9c 200%);
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.8);
    }

    .lunar-bug-tool h4 {
      color: white;
    }
  `}),eo.create(),Zn.create()});
